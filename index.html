<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0A0A12">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>CYBERBEAT | 波形音乐播放器</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="mobile.css" media="screen and (max-width: 768px)">
</head>
<body>
    
    <!-- 导航栏 -->
    <header>
        <div class="neon-bar"></div>
        <nav>
            <div class="logo">CYBERBEAT</div>
            <ul class="nav-links">
                <li><a href="#">首页</a></li>
                <li><a href="#">探索</a></li>
                <li><a href="#">歌单</a></li>
                <li><a href="#">实验室</a></li>
            </ul>
        </nav>
    </header>

    <!-- 主内容区 -->
    <main>
        <div class="player-container">
            <!-- 专辑封面 -->
            <div class="album-art">
                <div class="vinyl"></div>
                <img src="https://ts1.tc.mm.bing.net/th/id/R-C.cd4d1907b4bf2fdef5b8ac246b20c6fa?rik=W8PYNxfYr82YQA&riu=http%3a%2f%2fi.gtimg.cn%2fqqlive%2fimg%2fjpgcache%2ffiles%2fqqvideo%2f9%2f9wcrz7hl4qasz4m.jpg&ehk=EE1F1DIjerWCgoAht40kgy19qgYTPZf82L4xEvJoLfk%3d&risl=&pid=ImgRaw&r=0" alt="专辑封面">
            </div>

            <!-- 歌曲信息 -->
            <div class="track-info">
                <h2 class="track-title">NEON DREAMS</h2>
                <p class="artist">SYNTHWAVE_404</p>
            </div>

            <!-- 进度条 -->
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress" style="width: 0%"></div>
                </div>
                <div class="time-info">
                    <span class="current-time">0:00</span>
                    <span class="duration">0:00</span>
                </div>
            </div>

            <!-- 控制按钮 -->
            <div class="controls">
                <button class="control-btn mode"> <i class="fa-solid fa-right-long"></i></button>
                <button class="control-btn before"><i class="fas fa-step-backward"></i></button>
                <button class="control-btn play-btn"><i class="fas fa-play"></i></button>
                <button class="control-btn after"><i class="fas fa-step-forward"></i></button>
                <button class="control-btn"><i class="fas fa-redo"></i></button>
            </div>

            <!-- 音量控制 -->
            <div class="volume-control">
                <i class="fas fa-volume-up volume-icon"></i>
                <input type="range" class="volume-slider" min="0" max="100" value="70">
            </div>
            <!-- 频谱图 -->
            <div class="visualizer">
                <canvas id="spectrum"></canvas>
            </div>

            <div class="songlist recommended">
                <ul>
                    
                </ul>
                <ul>
                    <li>test</li>
                </ul>
            </div>
            <!-- 音频元素 -->
            <audio id="audio-player" src="" crossOrigin="anonymous"></audio> <!-- 增加跨域属性 -->
        </div>
    </main>

    <canvas id="particles"></canvas>
    <script>
        // 检测是否为移动端
        function isMobile() {
            return window.innerWidth <= 768;
        }

        // 控制底部播放栏的显示
        function toggleBottomPlayer() {
            const bottomPlayer = document.querySelector('.bottom-player');
            if (isMobile()) {
                if (!bottomPlayer) {
                    // 如果是移动端但没有底部播放栏，则创建
                    const playerHTML = `
                        <div class="bottom-player">
                            <div class="mini-info">
                                <img class="mini-cover" src="" alt="当前播放">
                                <div class="mini-text">
                                    <div class="mini-title">未播放</div>
                                    <div class="mini-artist">未知艺术家</div>
                                </div>
                            </div>
                            <div class="mini-controls">
                                <button class="control-btn play-btn mobile-play"><i class="fas fa-play"></i></button>
                                <button class="control-btn mobile-next"><i class="fas fa-forward"></i></button>
                            </div>
                        </div>
                    `;
                    document.body.insertAdjacentHTML('beforeend', playerHTML);
                }
            } else {
                // 如果是电脑端，移除底部播放栏
                if (bottomPlayer) {
                    bottomPlayer.remove();
                }
            }
        }

        // 页面加载时检查
        document.addEventListener('DOMContentLoaded', toggleBottomPlayer);
        
        // 窗口大小改变时检查
        window.addEventListener('resize', toggleBottomPlayer);

        // 修改后的音频初始化逻辑
        const backhost = 'http://127.0.0.1:3000/api';
        const audioPlayer = document.getElementById('audio-player');
        
        // 使用Fetch API替代XMLHttpRequest
        fetch(backhost, {
            credentials: 'include' // 允许携带cookie
        })
            .then(response => {
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return response.json(); // 假设后端返回JSON格式 { url: 'audio-file.mp3' }
            })
            .then(data => {
                audioPlayer.src = data.url;
                audioPlayer.load(); // 必须调用load()方法
                
            })
            .catch(error => {
                console.error('请求失败:', error);
                // 可以在这里设置默认音频源
                audioPlayer.src = '/fallback.mp3'; 
            });
    
        // 添加错误监听
        audioPlayer.addEventListener('error', function(e) {
            console.error('音频加载错误:', e.target.error);
        });
    </script>
    <script src="./my.js"></script>
    <script src="./musicPlayer.js"></script>
    <script src="./likedList.js"></script>
    <script src="./playlist.js"></script>
    
    
</body>
</html>